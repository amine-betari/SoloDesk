{% extends 'base.html.twig' %}
{% block title %}Modèles de documents{% endblock %}

{% block body %}
    <h1 class="text-2xl font-bold mb-2">Modèles de documents</h1>

    <div class="mb-6 bg-[#1F2732] border border-[#2A3747] rounded-lg p-4 text-gray-200">
        <div class="font-semibold mb-2">Comment utiliser les modèles</div>
        <ol class="text-sm text-gray-300 list-decimal list-inside space-y-1">
            <li>Télécharge un modèle Word, ouvre‑le et personnalise le design si besoin.</li>
            <li>Garde les placeholders (ex: <code>${reference}</code>, <code>${client_name}</code>, etc.).</li>
            <li>Uploade le fichier en “Facture” puis une seconde fois en “Devis”, et coche “par défaut”.</li>
        </ol>
        <div class="text-sm text-gray-300 mt-3">Placeholders disponibles</div>
        <ul class="text-sm text-gray-300 list-disc list-inside space-y-1">
            <li><code>${reference}</code>, <code>${date}</code>, <code>${total_ht}</code>, <code>${total_ttc}</code>, <code>${vat_rate}</code></li>
            <li><code>${company_name}</code>, <code>${company_ice}</code>, <code>${company_if}</code>, <code>${company_tp}</code>, <code>${company_address}</code>, <code>${company_city}</code>, <code>${company_country}</code>, <code>${company_phone}</code>, <code>${company_email}</code></li>
            <li><code>${client_name}</code>, <code>${client_email}</code>, <code>${client_phone}</code>, <code>${client_address}</code>, <code>${client_country}</code></li>
            <li>Lignes (table) : <code>${item_description}</code>, <code>${item_qty}</code>, <code>${item_unit_price}</code>, <code>${item_total}</code></li>
        </ul>
    </div>

    <div class="flex flex-col sm:flex-row gap-3 mb-4">
        <a href="{{ path('app_templates_upload') }}" class="inline-block px-4 py-2 bg-blue-600 text-white rounded text-center">Uploader un modèle</a>
        <a href="{{ path('app_templates_sample_word_invoice') }}" class="inline-block px-4 py-2 bg-[#2A3747] text-white rounded text-center">Télécharger modèle Facture</a>
        <a href="{{ path('app_templates_sample_word_estimate') }}" class="inline-block px-4 py-2 bg-[#2A3747] text-white rounded text-center">Télécharger modèle Devis</a>
    </div>

    <div class="overflow-x-auto">
        <table class="min-w-full bg-white border border-gray-200 rounded-lg shadow">
            <thead class="bg-gray-50">
            <tr>
                <th class="px-4 py-2 text-left">Nom</th>
                <th class="px-4 py-2 text-left">Type</th>
                <th class="px-4 py-2 text-left">Format</th>
                <th class="px-4 py-2 text-left">Fichier</th>
                <th class="px-4 py-2 text-left">Défaut</th>
                <th class="px-4 py-2 text-left">Actions</th>
            </tr>
            </thead>
            <tbody class="divide-y">
            {% for t in templates %}
                <tr>
                    <td class="px-4 py-2">{{ t.name }}</td>
                    <td class="px-4 py-2">{{ t.type }}</td>
                    <td class="px-4 py-2">{{ t.format }}</td>
                    <td class="px-4 py-2"><a class="text-blue-600 underline btn-mobile inline-block" href="/{{ t.filePath }}" target="_blank">voir</a></td>
                    <td class="px-4 py-2">
                        {% if t.isDefault %}
                            <span class="rounded bg-green-100 text-green-800 px-2 py-0.5 text-xs">Oui</span>
                        {% else %}
                            <span class="text-gray-500 text-xs">—</span>
                        {% endif %}
                    </td>
                    <td class="px-4 py-2">
                        <div class="flex flex-col sm:flex-row gap-2">
                            {% if not t.isDefault %}
                                <a href="{{ path('app_templates_set_default', {id: t.id}) }}" class="text-indigo-600 btn-mobile">Définir par défaut</a>
                            {% endif %}
                            <form method="post" action="{{ path('app_templates_delete', {id: t.id}) }}" onsubmit="return confirm('Supprimer ce modèle ?');" class="btn-mobile">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete_template' ~ t.id) }}">
                                <button class="text-red-600">Supprimer</button>
                            </form>
                        </div>
                    </td>
                </tr>
            {% else %}
                <tr><td colspan="6" class="px-4 py-4 text-center text-gray-500">Aucun modèle</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}
